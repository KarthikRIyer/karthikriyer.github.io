<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Hair Simulation with Position Based Dynamics | Karthik Ramesh Iyer</title> <meta name="author" content="Karthik Ramesh Iyer"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://karthikriyer.github.io/blog/2023/hair-sim/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Karthik </span>Ramesh Iyer</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Hair Simulation with Position Based Dynamics</h1> <p class="post-meta">December 11, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/animation"> <i class="fa-solid fa-hashtag fa-sm"></i> animation</a>     ·   <a href="/blog/category/project"> <i class="fa-solid fa-tag fa-sm"></i> project</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <figure> <iframe src="https://www.youtube.com/embed/944hJg1Kdng" class="img-fluid rounded z-depth-1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" width="auto" height="auto" min-width="1000"></iframe> </figure> <h1 id="overview">Overview</h1> <p>The goal of the project was to simulate multiple hair strands based on the paper “<a href="https://matthias-research.github.io/pages/publications/FTLHairFur.pdf" rel="external nofollow noopener" target="_blank">Fast Simulation of Inextensible Hair and Fur</a>” by Müller, et.al. The technique extends Position Based Dynamics and Follow-The-Leader to simulate inextensible strands. In addition, the paper presents a way to handle hair-hair interaction (including friction and hair-hair repulsion) that uses a variant of the technique presented in “<a href="https://graphics.pixar.com/library/Hair/paper.pdf" rel="external nofollow noopener" target="_blank">Volumetric Methods for Simulation and Rendering of Hair</a>” by Petrovic, Henne and Anderson.</p> <h1 id="algorithm-and-results">Algorithm and Results</h1> <h2 id="pbdftl">PBD/FTL</h2> <p>The paper extends FTL (Follow-the-Leader) for dynamic simulation. FTL deals with the behavior of a single strand. This is very similar to simulating an n-pendulum using PBD. With PBD, connected particles are moved towards each other in the inverse proportion of their masses. But to maintain inextensibility, we move only the second particle in each pair along the strand. If interpreted as mving particles in inverse proportion of masses, this results in the first particle having infinite mass, and the second particle having all the energy. This yields strange behavior:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/plain-ftl-compressed.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/plain-ftl-compressed.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/plain-ftl-compressed.gif-1400.webp"></source> <img src="/assets/img/plain-ftl-compressed.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Static FTL </div> <p>The technique proposed by Müller, et.al. introduces intentional numerical damping to hide the uneven mass distribution inherent to FTL. The steps for dynamic FTL with damping are:</p> <p>\(\mathbf{p} \xleftarrow{} \mathbf{x} \mathbf{+} \mathbf{\Delta} \mathbf{tv} \mathbf{+} \mathbf{\Delta} \mathbf{t^2 f}\) <br> \(\mathbf{p} \xleftarrow{} \mathbf{solveConstraints(p)}\) <br> \(\mathbf{d_i = \textbf{correction vector while solving constraints}}\) <br> \(\mathbf{v_i} \xleftarrow{} \mathbf{\frac{p_i - x_i}{\Delta t}} + s_{damping} \mathbf{\frac{-d_{i+1}}{\Delta t}}\) <br> \(\mathbf{x} \xleftarrow{} \mathbf{p}\) <br></p> <p>On implementing this we get a more reasonable strand simulation with a damping factor of 0.9.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dynamic-ftl.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dynamic-ftl.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dynamic-ftl.gif-1400.webp"></source> <img src="/assets/img/dynamic-ftl.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Dynamic FTL </div> <h2 id="hair-hair-interaction">Hair-hair interaction</h2> <p>A hair density voxel is created, and then additionally populated with particle velocities in order to find a weighted average. Averaging the velocity based on voxel density makes the particles close to each other move with similar velocities thereby imitating friction.</p> <p>Voxel density is given by:</p> <p>\(\mathbf{D_{xyz} = \sum^{}_{i} (1 - |P_x^i - x|)(1 - |P_y^i - y|)(1 - |P_z^i - z|)}\) <br></p> <p>And the average velocity at each point is given by:</p> <p>\(\mathbf{V_{xyz} = \frac{\sum^{}_{i} (1 - |P_x^i - x|)(1 - |P_y^i - y|)(1 - |P_z^i - z|)v^i}{D_{xyz}} }\) <br> The final particle velocity is updated as follows:</p> <p>\(\mathbf{v \xleftarrow{} (1 - s_{friction} v + s_{friction}v_{grid})}\) <br></p> <p>In order to implement repulsion, the technique presented by Müller, et.al. uses the above mentioned density voxel by Petrovic, et.al., but updates the velocities in a different way. First the normalized density gradient is computed at each point (\(\mathbf{g = \nabla \rho / \vert\nabla \rho\vert}\)). Then the velocity is updated as follows:</p> <p>\(\mathbf{v \xleftarrow{} v + s_{repulsion}g/\Delta t}\) <br></p> <p>Collision with static/kinematic objects (in this case, spheres) has been implemented using a penalty force based approach. Generally PBD collisions with static/kinematic objects are implemented by either solving a collision constraint or directly moving the colliding particle to the surface of the object. Since hair is inextensible, this technique yields unusual behaviour. The current workaround is to use a penalty force based technique, where at the beginning of each time-step, for each collision an extra force opposite to the collision vector is added along with a proportionality constant. The downside of this method is that the proportionality constant is empirical. But with some efforts it yields decent results.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/hair-interaction-collision.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/hair-interaction-collision.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/hair-interaction-collision.gif-1400.webp"></source> <img src="/assets/img/hair-interaction-collision.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Hair-hair interaction and collision with static/kinematic objects </div> <p>Finally I built a scene with the Victor 3d model from from A3, and gave him some hair! First I imported the mesh in blender, separated the scalp vertices and exported it to an obj. I then imported the scalp mesh into my hair simulator, genrated random points within the triangulated scalp mesh, which were then used as roots for the hair. The body mesh is approximated with 5 spheres for collision (one for each, head, nech, left shoulder, right shoulder and chest). Additionally I also added an osscilating wind force field to make things interesting. Here’s the result!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/victor-hair.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/victor-hair.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/victor-hair.gif-1400.webp"></source> <img src="/assets/img/victor-hair.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Hair on a character </div> <h2 id="code-repository">Code Repository</h2> <p>GitHub Repo: <a href="https://github.com/KarthikRIyer/HairSim" rel="external nofollow noopener" target="_blank">HairSim</a></p> <h2 id="acknowledgements">Acknowledgements</h2> <ul> <li>The OpenGL boilerplate code has been borrowed from Prof. Sueda’s assignment material and has been modified for OpenGL 4.x.</li> <li>The project is based on the papers: <ul> <li>“<a href="https://matthias-research.github.io/pages/publications/FTLHairFur.pdf" rel="external nofollow noopener" target="_blank">Fast Simulation of Inextensible Hair and Fur</a>” by Müller, et.al.</li> <li>“<a href="https://graphics.pixar.com/library/Hair/paper.pdf" rel="external nofollow noopener" target="_blank">Volumetric Methods for Simulation and Rendering of Hair</a>” by Petrovic, Henne and Anderson</li> </ul> </li> <li> <a href="https://github.com/g-truc/glm" rel="external nofollow noopener" target="_blank">GLM</a> and <a href="https://eigen.tuxfamily.org/index.php?title=Main_Page" rel="external nofollow noopener" target="_blank">Eigen</a> were used for vector math</li> <li> <a href="https://github.com/oneapi-src/oneTBB" rel="external nofollow noopener" target="_blank">oneTBB</a> was used for multi-threading</li> <li>The <a href="https://s3-us-west-1.amazonaws.com/fti.website.assets/training/FacewareTech_Victor_Maya.zip" rel="external nofollow noopener" target="_blank">Victor 3D Model</a> is from <a href="https://facewaretech.com/learn/free-assets" rel="external nofollow noopener" target="_blank">facewaretech.com</a> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/gsoc-coding-phase-part-1/">GSoC Coding Phase - Part 1</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/gsoc-coding-phase-part-3/">GSoC Coding Phase - Part 3</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/gsoc-20-final-report-copy/">GSoC '20 Final Report</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/gsoc-coding-phase-part-4/">GSoC Coding Phase - Part 4</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/gsoc-coding-phase-part-2/">GSoC Coding Phase - Part 2</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Karthik Ramesh Iyer. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>